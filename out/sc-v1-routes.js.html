<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: sc-v1-routes.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: sc-v1-routes.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @name sc-v1-routes-api
 * @description This module packages the JSON patch and Image thumbnail generation API (post login).
 */
'use strict';

const hydraExpress = require('hydra-express');
const hydra = hydraExpress.getHydra();
const express = hydraExpress.getExpress();
const jwtAuth = require('fwsp-jwt-auth');
var jsonpatch = require('jsonpatch');
var Jimp = require('jimp');

const ServerResponse = require('fwsp-server-response');

let serverResponse = new ServerResponse();
serverResponse.enableCORS(true);express.response.sendError = function(err) {
  serverResponse.sendServerError(this, {result: {error: err}});
};
express.response.sendOk = function(result) {
  serverResponse.sendOk(this, {result});
};

let api = express.Router();

/**
* @name Image thumbnail generation api
* @description Uses 'jimp' npm module for generate 50x50 thumbnail images from public image URLs.
*/

api.get('/imageupload', function(req, res){
    res.render('imageupload');
})

api.post('/imageoutput', function(req, res){
  if(req.body.image.trim() != ""){
    Jimp.read(req.body.image, function (err, image) {
      if(err){
        res.send(err);
      }
      else{
        image.resize(50, 50)
         .getBuffer(Jimp.MIME_JPEG, function(err, buffer){
           if(err){
             res.send(err);
           }
            res.setHeader('content-type', 'image/jpeg');

            res.send(buffer);
          })
      }
    });
  }
  else{
    res.send("Incorrect data");
  }
})

/**
* @name JSON patch API
* @description Uses 'jsonpatch' npm module for applying patches over json objects
*/

api.get('/jsoninput', function(req, res){
    res.render('jsonpatchinput');
})

api.post('/jsonoutput', function(req, res){
  var obj = JSON.parse(req.body.json_object);
  var patch = JSON.parse(req.body.json_patch);
  res.send(JSON.stringify(jsonpatch.apply_patch(obj, patch),null,2));
})

/**
* @name Authentication and dashboard rendering API
* @description This api is the public endpoint with login authentication functionality. Uses JSON Web Tokens for validation.
*/

api.post('/dashboard', function(req, res){
  if(req.body.username == "aman" &amp;&amp; req.body.password == "musicstar"){
    hydraExpress.use(new JWTAuthPlugin());
    res.render('dashboard');
  }
  else{
    res.send("Incorrect login");
  }
})

api.get('/dashboard', function(req, res){
    res.render('dashboard');
})

// api.get('/', hydraExpress.validateJwtToken(),
// (req, res) => {
//   res.sendOk({greeting: 'Welcome to Hydra Express!'});
// });

module.exports = api;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#AuthenticationanddashboardrenderingAPI">Authentication and dashboard rendering API</a></li><li><a href="global.html#Imagethumbnailgenerationapi">Image thumbnail generation api</a></li><li><a href="global.html#JSONpatchAPI">JSON patch API</a></li><li><a href="global.html#sc-v1-routes-api">sc-v1-routes-api</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Sun May 21 2017 15:03:18 GMT+0530 (IST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
